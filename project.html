<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Automa√ß√£o de Pesquisa de NPS para Chamadas Telef√¥nicas</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            line-height: 1.6;
            margin: 20px;
            color: #333;
        }
        h1, h2, h3 {
            color: #2c3e50;
        }
        h1 {
            border-bottom: 2px solid #2c3e50;
            padding-bottom: 10px;
        }
        h2 {
            margin-top: 30px;
            border-bottom: 1px solid #ddd;
            padding-bottom: 5px;
        }
        pre {
            background-color: #f4f4f4;
            padding: 15px;
            border-radius: 5px;
            overflow-x: auto;
        }
        code {
            font-family: Consolas, monospace;
            color: #c7254e;
        }
        ul {
            margin: 10px 0;
            padding-left: 20px;
        }
        ul li {
            margin-bottom: 10px;
        }
        .section {
            margin-bottom: 40px;
        }
        .highlight {
            background-color: #f9f9f9;
            padding: 10px;
            border-left: 4px solid #2c3e50;
            margin: 20px 0;
        }
        .json-example {
            background-color: #f4f4f4;
            padding: 15px;
            border-radius: 5px;
            margin: 20px 0;
        }
        .footer {
            margin-top: 50px;
            padding-top: 20px;
            border-top: 1px solid #ddd;
            text-align: center;
            color: #777;
        }
    </style>
</head>
<body>
    <h1>Automa√ß√£o de Pesquisa de NPS para Chamadas Telef√¥nicas</h1>

    <div class="section">
        <h2>1Ô∏è‚É£ Captura e Recebimento dos Eventos das Chamadas</h2>
        <p>Toda a base da automa√ß√£o come√ßa com o monitoramento das liga√ß√µes. Como detalhei no reposit√≥rio <strong>Call Events Reports</strong>, configurei a captura dos eventos diretamente da API da GoTo.</p>
        <p>Cada evento gera um JSON extremamente detalhado, com informa√ß√µes como:</p>
        <ul>
            <li>Tipo da chamada (ativa ou receptiva)</li>
            <li>N√∫mero do cliente</li>
            <li>Ramal do atendente</li>
            <li>Status da chamada (completada, perdida, cancelada)</li>
            <li>Dura√ß√£o da liga√ß√£o</li>
            <li>C√≥digo de encerramento (quem desligou: cliente ou atendente)</li>
        </ul>
        <p>Ap√≥s o t√©rmino da liga√ß√£o, a API dispara automaticamente um webhook para o n8n, enviando esse JSON completo para o fluxo de automa√ß√£o.</p>
    </div>

    <div class="section">
        <h2>2Ô∏è‚É£ Processamento dos Dados no n8n com JavaScript</h2>
        <p>Aqui entra a parte mais inteligente da automa√ß√£o. Configurei dois caminhos distintos no n8n ‚Äî um para chamadas receptivas e outro para chamadas ativas.</p>
        <p>Com os n√≥s de <strong>Function</strong> e <strong>Function Item</strong>, manipulei o JSON usando JavaScript para:</p>
        <ul>
            <li>Identificar o tipo de chamada (incoming ou outgoing).</li>
            <li>Tratar os dados recebidos, validando n√∫meros, dura√ß√£o e status da chamada.</li>
            <li>Aplicar regras de neg√≥cio, como filtrar chamadas com menos de 10 segundos (consideradas falhas).</li>
            <li>Formatar o JSON para deixar s√≥ as informa√ß√µes relevantes para a pesquisa.</li>
        </ul>
        <div class="json-example">
            <h3>Exemplo de JSON Recebido:</h3>
            <pre><code>{
  "call_id": "abc123",
  "direction": "incoming",
  "from": "+5511998765432",
  "to": "08001234567",
  "status": "completed",
  "duration": 180,
  "end_cause": "caller_hung_up",
  "agent": {
    "name": "Jo√£o Silva",
    "extension": "202"
  }
}</code></pre>
        </div>
        <div class="highlight">
            <p><strong>üëâ Fluxo 1: Chamadas Receptivas</strong></p>
            <p>Se a chamada foi receptiva (<code>"direction": "incoming"</code>), o cliente recebe a pesquisa de NPS logo ap√≥s a liga√ß√£o ser encerrada. O JSON √© filtrado para extrair o nome do atendente, n√∫mero do cliente e dura√ß√£o da chamada.</p>
        </div>
        <div class="highlight">
            <p><strong>üëâ Fluxo 2: Chamadas Ativas</strong></p>
            <p>Se a chamada foi ativa (<code>"direction": "outgoing"</code>), o mesmo fluxo √© seguido, mas com uma regra extra: s√≥ dispara a pesquisa se a chamada durar mais de 30 segundos (evitando liga√ß√µes sem intera√ß√£o significativa).</p>
        </div>
    </div>

    <div class="section">
        <h2>3Ô∏è‚É£ Disparo da Pesquisa e Monitoramento das Respostas</h2>
        <p>Ap√≥s o tratamento dos dados, o fluxo segue para o envio da pesquisa de NPS ao cliente.</p>
        <p>Caso o cliente d√™ uma nota entre 1 e 3, o n8n dispara um e-mail autom√°tico para o supervisor, contendo:</p>
        <ul>
            <li>Nome do cliente</li>
            <li>N√∫mero da chamada</li>
            <li>Nota recebida</li>
            <li>Protocolo da liga√ß√£o</li>
        </ul>
        <p>Esse e-mail permite que a equipe de supervis√£o entre em contato rapidamente para entender o motivo da insatisfa√ß√£o e tentar reverter a experi√™ncia negativa.</p>
    </div>

    <div class="section">
        <h2>4Ô∏è‚É£ Armazenamento e An√°lise dos Dados com Power BI (e Melhorias)</h2>
        <p>Os dados das chamadas e das respostas do NPS s√£o exportados para uma planilha, que alimenta um dashboard no <strong>Power BI</strong> via <strong>Power Query</strong>. Para aprimorar a an√°lise e a visualiza√ß√£o dos dados, implementei as seguintes melhorias:</p>
        <ul>
            <li><strong>Dashboard Interativo:</strong> Gr√°ficos din√¢micos, como gr√°ficos de barras, mapas de calor e gr√°ficos de tend√™ncias.</li>
            <li><strong>Indicadores Chave (KPIs):</strong> NPS m√©dio, taxa de respostas, tempo m√©dio de dura√ß√£o das chamadas e percentual de notas baixas.</li>
            <li><strong>Detalhamento por Atendente:</strong> Desempenho individual de cada atendente.</li>
            <li><strong>Alertas Autom√°ticos:</strong> Destaque para quedas no NPS e aumento no volume de chamadas perdidas.</li>
            <li><strong>Integra√ß√£o com Outras Fontes de Dados:</strong> CRM e sistema de tickets para an√°lises mais profundas.</li>
            <li><strong>Relat√≥rios Automatizados:</strong> Envio semanal e mensal de relat√≥rios para a equipe de supervis√£o.</li>
        </ul>
    </div>

    <div class="section">
        <h2>üìå Reposit√≥rios do Projeto</h2>
        <ul>
            <li><strong>Call Events Reports:</strong> Explica em detalhes como funciona a captura das chamadas e o envio dos eventos via webhook para o n8n.</li>
            <li><strong>nps-pabx - Grupo Ramos:</strong> Cont√©m o fluxo completo configurado no n8n para processar os dados, disparar a pesquisa e notificar a equipe.</li>
        </ul>
    </div>

    <div class="section">
        <h2>‚úÖ Principais Resultados</h2>
        <ul>
            <li>Cobertura total das chamadas, com suporte a ativas e receptivas.</li>
            <li>E-mail autom√°tico para supervisores em notas baixas (1 a 3).</li>
            <li>Dashboard atualizado no Power BI, com an√°lise em tempo real e visualiza√ß√µes interativas.</li>
            <li>Processamento avan√ßado de JSON via JavaScript no n8n para controle total dos dados.</li>
            <li>Insights acion√°veis para melhorar a experi√™ncia do cliente e o desempenho da equipe.</li>
        </ul>
    </div>

    <div class="footer">
        <p>Esse projeto foi uma das automa√ß√µes mais completas que desenvolvi, integrando JavaScript, n8n, GoTo e Power BI para entregar uma solu√ß√£o pr√°tica, inteligente e, acima de tudo, funcional para o Grupo Ramos.</p>
    </div>
</body>
</html>